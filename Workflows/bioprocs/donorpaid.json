{
	"$schema": "../../@schemas/statemachine-schema.json#",
	"Description": "PaidDonor",
	"InitialState": "WaitSurvey",
	"States": {
		"WaitSurvey": {
			"Description": "Очікує ЛПОД",
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs.sqlserver:ExecuteSqlActivity",
						"Procedure": "a2bioprocs.[Visit.Start]",
						"Parameters": {
							"Instance": "{{instance.Id}}",
							"Visit": "{{params.visitId}}"
						}
					},
					{
						"$res": "com.a2v10.procs:CallHttpApiActivity",
						"Url": "{{env.Scoreboard.Url}}/api/hub/send",
						"Method": "Post",
						"Body": "{event: 'stateChange', visitId: params.visitId, donorId: params.donorId, state:instance.CurrentState}",
						"HandleError": "Ignore"
					},
					{
						"$res": "com.a2v10.procs:WaitResumeActivity",
						"Bookmark": "WaitSurvey"
					}
				]
			},
			"NextState": "InviteSurvey"
		},
		"InviteSurvey": {
			"Description": "Запрошено до ЛПОД",
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs:CallHttpApiActivity",
						"Url": "{{env.Scoreboard.Url}}/api/hub/send",
						"Method": "Post",
						"Body": "{event: 'stateChange', visitId: params.visitId, donorId: params.donorId, state:instance.CurrentState}",
						"HandleError": "Ignore"
					},
					{
						"$res": "com.a2v10.procs:WaitResumeActivity",
						"Bookmark": "InviteSurvey"
					}
				]
			},
			"NextState": "Survey"
		},
		"Survey": {
			"Description": "Обстежується в ЛПОД",
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs:CallHttpApiActivity",
						"Url": "{{env.Scoreboard.Url}}/api/hub/send",
						"Method": "Post",
						"Body": "{event: 'stateChange', visitId: params.visitId, donorId: params.donorId, state:instance.CurrentState}",
						"HandleError": "Ignore"
					},
					{
						"$res": "com.a2v10.procs:WaitResumeActivity",
						"Bookmark": "Survey"
					}
				]
			},
			"NextState": "WaitDoctor"
		},
		"WaitDoctor": {
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs:WaitResumeActivity",
						"Bookmark": "WaitDoctor"
					}
				]
			},
			"NextState": "InviteDoctor"
		},
		"InviteDoctor": {
			"Description": "Обстежується в ЛПОД",
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs:CallHttpApiActivity",
						"Url": "{{env.Scoreboard.Url}}/api/hub/send",
						"Method": "Post",
						"Body": "{event: 'stateChange', visitId: params.visitId, donorId: params.donorId, state:instance.CurrentState}",
						"HandleError": "Ignore"
					},
					{
						"$res": "com.a2v10.procs:WaitResumeActivity",
						"Bookmark": "InviteDoctor"
					}
				]
			},
			"NextState": "Doctor"
		},
		"Doctor": {
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs:CallHttpApiActivity",
						"Url": "{{env.Scoreboard.Url}}/api/hub/send",
						"Method": "Post",
						"Body": "{event: 'stateChange', visitId: params.visitId, donorId: params.donorId, state:instance.CurrentState}",
						"HandleError": "Ignore"
					},
					{
						"$res": "com.a2v10.procs:WaitResumeActivity",
						"Bookmark": "Doctor"
					}
				]
			},
			"NextState": "WaitDonation"
		},
		"WaitDonation": {
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs:CallHttpApiActivity",
						"Url": "{{env.Scoreboard.Url}}/api/hub/send",
						"Method": "Post",
						"Body": "{event: 'stateChange', visitId: params.visitId, donorId: params.donorId, state:instance.CurrentState}",
						"HandleError": "Ignore"
					},
					{
						"$res": "com.a2v10.procs:WaitResumeActivity",
						"Bookmark": "WaitDonation"
					}
				]
			},
			"NextState": "Donation"
		},
		"Donation": {
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs:CallHttpApiActivity",
						"Url": "{{env.Scoreboard.Url}}/api/hub/send",
						"Method": "Post",
						"Body": "{event: 'stateChange', visitId: params.visitId, donorId: params.donorId, state:instance.CurrentState}",
						"HandleError": "Ignore"
					},
					{
						"$res": "com.a2v10.procs:WaitResumeActivity",
						"Bookmark ": "Donation"
					}
				]
			},
			"NextState": "End"
		},
		"End": {
		}
	}
}