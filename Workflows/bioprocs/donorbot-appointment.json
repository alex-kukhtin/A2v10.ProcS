{
	"$schema": "../../@schemas/statemachine-schema.json#",
	"Description": "DonorBot",
	"InitialState": "Init",
	"States": {
		"Init": {
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs.chatbot:SendMessageActivity",
						"BotEngine": "Telegram",
						"BotKey": "DonorBot",
						"ChatId": "{{params.ChatId}}",
						"Message": {
							"Type": "Text",
							"Text": "Вітаємо шановний доноре!"
						}
					}
				]
			},
			"NextState": "Loop"
		},
		"Loop": {
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs.chatbot:SendMessageActivity",
						"BotEngine": "Telegram",
						"BotKey": "DonorBot",
						"ChatId": "{{params.ChatId}}",
						"Message": {
							"Type": "Keyboard",
							"Text": "Do something:",
							"Keyboard": {
								"ColNum": 1,
								"Buttons": [
									{
										"Text": "Записатись на донацію"
									}
								]
							}
						}
					},
					{
						"$res": "com.a2v10.procs.chatbot:WaitMessageActivity",
						"BotEngine": "Telegram",
						"BotKey": "DonorBot",
						"ChatId": "{{params.ChatId}}"
					}
				]
			},
			"Transitions": {
				"Loop->Ask1": {
					"Condition": "reply.Message.Text == 'Записатись на донацію'",
					"To": "Ask1"
				},
				"Loop->Loop": {
					"To": "Loop"
				}
			}
		},
		"Deny": {
			"OnEntry": {
				"$res": "com.a2v10.procs.chatbot:SendMessageActivity",
				"BotEngine": "Telegram",
				"BotKey": "DonorBot",
				"ChatId": "{{params.ChatId}}",
				"Message": {
					"Type": "Text",
					"Text": "Вибачте, але наразі Ви не можете здійснити донацію"
				}
			},
			"NextState": "Loop"
		},
		"Ask1": {
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs.chatbot:SendMessageActivity",
						"BotEngine": "Telegram",
						"BotKey": "DonorBot",
						"ChatId": "{{params.ChatId}}",
						"Message": {
							"Type": "Text",
							"Text": "Вам необхідно відповісти на питання анкети донора"
						}
					},
					{
						"$res": "com.a2v10.procs.chatbot:SendMessageActivity",
						"BotEngine": "Telegram",
						"BotKey": "DonorBot",
						"ChatId": "{{params.ChatId}}",
						"Message": {
							"Type": "Keyboard",
							"Text": "Як почуваєте себе? Добре?",
							"Keyboard": {
								"ColNum": 2,
								"Buttons": [
									{
										"Text": "Так"
									},
									{
										"Text": "Ні"
									}
								]
							}
						}
					},
					{
						"$res": "com.a2v10.procs.chatbot:WaitMessageActivity",
						"BotEngine": "Telegram",
						"BotKey": "DonorBot",
						"ChatId": "{{params.ChatId}}"
					}
				]
			},
			"Transitions": {
				"Ask1->Ask2": {
					"Condition": "reply.Message.Text == 'Так'",
					"To": "Ask2"
				},
				"Ask1->Deny": {
					"To": "Deny"
				}
			}
		},
		"Ask2": {
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs.chatbot:SendMessageActivity",
						"BotEngine": "Telegram",
						"BotKey": "DonorBot",
						"ChatId": "{{params.ChatId}}",
						"Message": {
							"Type": "Keyboard",
							"Text": "Чи є у Вас зараз температура, болі в горлі, простуда, респіраторні захворювання, ангіна?",
							"Keyboard": {
								"ColNum": 2,
								"Buttons": [
									{
										"Text": "Так"
									},
									{
										"Text": "Ні"
									}
								]
							}
						}
					},
					{
						"$res": "com.a2v10.procs.chatbot:WaitMessageActivity",
						"BotEngine": "Telegram",
						"BotKey": "DonorBot",
						"ChatId": "{{params.ChatId}}"
					}
				]
			},
			"Transitions": {
				"Ask2->Ask3": {
					"Condition": "reply.Message.Text == 'Ні'",
					"To": "Ask2"
				},
				"Ask1->Deny": {
					"To": "Deny"
				}
			}
		},
		"Ask3": {
			"OnEntry": {
				"$res": "com.a2v10.procs:SequenceActivity",
				"Activities": [
					{
						"$res": "com.a2v10.procs.chatbot:SendMessageActivity",
						"BotEngine": "Telegram",
						"BotKey": "DonorBot",
						"ChatId": "{{params.ChatId}}",
						"Message": {
							"Type": "Text",
							"Text": "Оберіть зручні дату та час дотації"
						}
					},
					{
						"$res": "com.a2v10.procs.chatbot:WaitMessageActivity",
						"BotEngine": "Telegram",
						"BotKey": "DonorBot",
						"ChatId": "{{params.ChatId}}"
					},
					{
						"$res": "com.a2v10.procs.chatbot:SendMessageActivity",
						"BotEngine": "Telegram",
						"BotKey": "DonorBot",
						"ChatId": "{{params.ChatId}}",
						"Message": {
							"Type": "Text",
							"Text": "Очикуємо на Вас {{reply.Message.Text}}"
						}
					}
				]
			},
			"NextState": "Loop"
		}
	}
}